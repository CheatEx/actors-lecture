[comment]: # (Set the theme:)
[comment]: # (THEME = white)
[comment]: # (CODE_THEME = base16/zenburn)
[comment]: # (The list of themes is at https://revealjs.com/themes/)
[comment]: # (The list of code themes is at https://highlightjs.org/)

[comment]: # "You can also use quotes instead of parenthesis"
[comment]: # "THEME = white"

[comment]: # (Pass optional settings to reveal.js:)
[comment]: # (controls: true)
[comment]: # (keyboard: true)
[comment]: # (markdown: { smartypants: true })
[comment]: # (hash: false)
[comment]: # (respondToHashChanges: false)
[comment]: # (Other settings are documented at https://revealjs.com/config/)

<style>
.reveal h1,
.reveal h2,
.reveal h3,
.reveal h4,
.reveal h5,
.reveal h6 {
  font-family: Helvetica, sans-serif;
}
</style>

## Акторы

Алексей Злобин | Dell-EMC

[comment]: # (!!!)

### Многопоточность с разделяемой памятью

Удобно?

[comment]: # (!!!)

### Многопоточность с разделяемой памятью

~~Удобно?~~

* Недетерменизм
* Дэдлоки
* Ливлоки
* Голодания
* Недоиспользование CPU
* Плохая масштабируемость
* Накладные расходы на синхронизацию и планирование

[comment]: # (!!!)

### Многопоточность с разделяемой памятью

~~Удобно?~~

* Ограничить взаимодействие потоков
* Абстрагироваться от аппаратной реализации

[comment]: # (!!!)

### Модель акторов

[comment]: # (!!!)

### Модель акторов: ограничения

Актор - процесс с идентичностью, потоком исполнения и состоянием

[comment]: # (!!!)

### Модель акторов: ограничения

Актор - имеет уникальный адрес для отправки сообщений

[comment]: # (!!!)

### Модель акторов: ограничения

Актор - может создавать новые акторы и получать их адреса

[comment]: # (!!!)

### Модель акторов: ограничения

Актор - может отправлять сообщения другим акторам адреса которых сам знает

[comment]: # (!!!)

### Модель акторов: ограничения

Актор - может изменить своё состояние реагируя на пришедшее сообщение

[comment]: # (!!!)

### Модель акторов: следствия

Актор может менять своё состояние без координации с другими

[comment]: # (!!!)

### Модель акторов: следствия

Актор не обязан останавливать выполнение для коммуникации

[comment]: # (!!!)

### Модель акторов: следствия

Среда выполнения может останавливать и запускать акторы независимо без ущерба производительности и доступности

[comment]: # (!!!)

### Модель акторов: следствия

Среда выполнения может эффективно управлять ресурсами вместо акторов

[comment]: # (!!!)

### Модель акторов: следствия

Среда выполнения может сохранять работоспособность при потере одиночных акторов

[comment]: # (!!!)

### Наивная реализация

[comment]: # (!!!)

### Безопасная реализация с виртуализацией

* Планирования
* Управления памятью
* Коммуникации
* Ввода-вывода

[comment]: # (!!!)

### Erlang и BEAM VM

[comment]: # (!!!)

### Erlang и BEAM VM: происхождение

* Компания Ericsson и управление сетевым оборудованием
* Середина 80х - осознание проблем конкурентного программирования и отказоусточивости в нативных приложениях
* Конец 80х - попытка реализации ВМ с акторами и языка
* Середина 90х - современная ВМ BEAM и язык Erlang
* Конец 90х потеря коммерческого интереса и публикация в Open Source

[comment]: # (!!!)

### Сдвиг терминологии

Процессы

[comment]: # (!!!)

### Erlang и BEAM VM: дополнительные ограничения

* Неизменяемые структуры данных
* Состояние процесса - полностью размещается в стэке
* Сообщения упорядочены в очередь
* Получение сообщения - явная операция

[comment]: # (!!!)

### Особенности BEAM: масштабируемость

Миллионы процессов

[comment]: # (!!!)

### Особенности BEAM: планировщик

Полностью реализован в User Space

Вытесняющий

Умеет создавать OC процессы когда это требуется

[comment]: # (!!!)

### Особенности BEAM: управление памятью

Отдельный Heap для каждого процесса

Независимая сборка мусора

#### Разделяемые области памяти для специальных задач

* Код
* Константы
* Сырые массивы байт
* Встроенная БД

[comment]: # (!!!)

### Особенности BEAM: управление ресурсами

Привязываются к процессам создателями освобождаются в случае их смерти

[comment]: # (!!!)

### Особенности BEAM: служба имен

Позволяет именовать процессы и обращаться к ним по именам

[comment]: # (!!!)

### Особенности BEAM: тюнинг

Детально настраиваются:

* Планировщик
* Взаимодействие с ОС
* Квоты ресурсов

[comment]: # (!!!)

### Особенности BEAM: внедрение и развертывание

Встроены низкоуровневые API для:

* Мониторинга
* Трассировки
* Профилирования
* Отладки

Встроены также простые пользовательские инструменты для всех этих областей

[comment]: # (!!!)

### Особенности BEAM: выводы

Высокая устойчивость как к системным отказам так и к ошибкам программирования

[comment]: # (!!!)

### Elixir

Почему?

[comment]: # (!!!)

### Elixir: основные особенности

* Динамическая типизация
* Неизменяемые структуры данных
* Паттерн-матчинг как основная управляющая конструкция
* Метапрограммирование

[comment]: # (!!!)

### Elixir

Демо

[comment]: # (!!!)

### OTP

В широком смысле - набор библиотек для создания приложений
В узком смысле - шаблон структурирования процессов для отказоустойчивости и управляемости приложений

[comment]: # (!!!)

### OTP

Достаточно ли линков и простой стратегии перезапуска "корневого" процесса?

[comment]: # (!!!)

### OTP

Дерево супервизоров

[comment]: # (!!!)

### OTP

GenServer

[comment]: # (!!!)

### OTP

GenSupervisor

[comment]: # (!!!)

### OTP

Application

[comment]: # (!!!)

### OTP

Release

[comment]: # (!!!)

### Elixir behavoir

Demo

[comment]: # (!!!)

### OTP пример

#### Echo server

* Устойчивый к сбоям сети и клиентов
* Устойчивый к ошибкам программирования
* Пригодный для повторного использования

[comment]: # (!!!)

### Echo server

* Процесс сервер: приём соединений
* Процесс обработчик: получение данных и эхо
* Супервизор обработчиков
* Супервизор компонента

[comment]: # (!!!)

### Echo server

Application

[comment]: # (!!!)

### Echo server

ServerSupervisor

[comment]: # (!!!)

### Echo server

Server

[comment]: # (!!!)

### Echo server

Handler

[comment]: # (!!!)

### Перспективы

[comment]: # (!!!)

### Альтернативы

* Библиотеки акторов для популярных языков
  
[comment]: # (!!!)

### Альтернативы:CSP

Go, Clojure core.async

* +
* -

[comment]: # (!!!)

### Альтернативы: сoroutines

Kotlin coroutines, старые Лиспы, Scala

* +
* -
* 
[comment]: # (!!!)

### Альтернативы: Cluster management

Kubernetes, TODO

* +
* -

[comment]: # (!!!)

### Альтернативы: unikernels

* +
* -
  
[comment]: # (!!!)

### Альтернативы: STM

Clojure

* +
* -

[comment]: # (!!!)

### Ссылки

1. Gul Agha; Ian Mason; Scott Smith; Carolyn Talcott. A Foundation for Actor Computation. Journal of Functional Programming, 1993
2. Robert Virding. Hitchhiker's Tour of the BEAM. Erlang User Conference, 2014
3. Joe Armstrong. Making reliable distributed systems in the presence ofsodware errors. Dissertation, 2003
